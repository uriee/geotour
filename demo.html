<!DOCTYPE html>
<html>
  <head>
    <title>mobiForge geolocation map API demo</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style>
      body,html {}
       #map{
        width: 300px;
        height: 500px;
      }}
    </style>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var map; 
      function initGeolocation() {
        if (navigator && navigator.geolocation) {
        var watchId = navigator.geolocation.watchPosition(successCallback, 
                                                          errorCallback,
                                                          {enableHighAccuracy:true,timeout:60000,maximumAge:0});

        } else {
          console.log('Geolocation is not supported');
        }
      }
     
      function errorCallback() {console.log("error with navigator object");}

      function successCallback(position) {
        var myLatlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        var TLatlng = new google.maps.LatLng(position.coords.latitude+0.0005, position.coords.longitude+0.0005);
        if(map == undefined) {
          var myOptions = {
            zoom: 16,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
          }
          map = new google.maps.Map(document.getElementById("map"), myOptions);
        }
        else map.panTo(myLatlng);
    
        var targetOption = {
          position: TLatlng,
          map: map,
          title: 'Target',
          draggable:true,
          animation : google.maps.Animation.DROP
        };
        var currentOption = {
          position: myLatlng,
          map: map,
          title: 'Current',
          animation : google.maps.Animation.DROP
        };

        var Tmarker = new google.maps.Marker(targetOption);
        var Cmarker = new google.maps.Marker(currentOption);
        
        google.maps.event.addListener(Tmarker,'drag',function(event) {
          document.getElementById('lat').value = event.latLng.lat();
          document.getElementById('lng').value = event.latLng.lng();
        });

        google.maps.event.addListener(Tmarker,'dragend',function(event) {
          document.getElementById('lat').value = event.latLng.lat();
          document.getElementById('lng').value = event.latLng.lng();
        });        
      }

    
    </script>
  </head>
  <body onload="javascript:initGeolocation()">
  <input id='lat'>lat</input>  
  <input id='lng'>lng</input>  
  <input id='hours'>Hours</input>  
  <input id='minuts'>Minutes</input>  
  <input id='go' type='button'>GO</input>
  <div id="map"></div>
  <div id="timer">      
 timer
    </div>
<script>
  var socket = io(); 
  $("#go").on('click', function(e) {
    console.log('ingo',e);
    H = $("#hours").val();
    M = $("#minuts").val();  
    console.log('ingo',H,M);
    if (H < 1) {
      H=0;
      if(M<1){
        alert("ggg");
        return;
      }
    }
    /*
    data = {};
    data.hours = H;
    data.minuts = M;
    data.lat = $('#lat').val();
    data.lng = $('#lng').val();
    socket.emit('start',data)
    */
    if(M==0) M=1;
    count(H,M);
  });

  var count = function(h,m){
    console.log('incount',h,m);
    $('#timer').text(h+':'+m);
    timer = setInterval(function(){
      console.log("interval",h,m);
      m=m-1;

      if(m==0){
        if(h==0) {
          $('#timer').text('0:00');
          clearInterval(timer);
        }
      };
      if(m==-1){
        m=59;
        h=h-1;
      }
      $('#timer').text( h+':'+m);
    },1000,h,m);
  };
     
</script>
  </body>
</html>